package com.gamesense.client.module.modules.exploits;

import com.gamesense.api.setting.values.BooleanSetting;
import com.gamesense.api.setting.values.IntegerSetting;
import com.gamesense.api.util.player.InventoryUtil;
import com.gamesense.client.module.Category;
import com.gamesense.client.module.Module;
import net.minecraft.client.gui.inventory.GuiContainer;
import net.minecraft.entity.player.EntityPlayer;
import net.minecraft.item.ItemExpBottle;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.CPacketHeldItemChange;
import net.minecraft.network.play.client.CPacketPlayer;
import net.minecraft.util.EnumHand;
import net.minecraft.world.World;

@Module.Declaration(name = "SilentEXP", category = Category.Exploits)
public class SilentEXP extends Module {
	
	BooleanSetting aim = registerBoolean("Aim", false);
	IntegerSetting pitch = registerInteger("Pitch", 90, 0, 90);
	
	public void onUpdate() {
		if(mc.player == null || mc.world == null) {
			disable();
			return;
		}
		
		if(mc.currentScreen == null || !(mc.currentScreen instanceof GuiContainer)) {
			int xp = InventoryUtil.findFirstItemSlot(ItemExpBottle.class, 0, 8);
			int oldSlot = mc.player.inventory.currentItem;
			float angle = mc.player.rotationPitch;
			if(aim.getValue()) {
				mc.player.connection.sendPacket((Packet<?>)new CPacketPlayer.Rotation(mc.player.rotationYaw, pitch.getValue(), mc.player.onGround));
			}
			mc.player.connection.sendPacket(new CPacketHeldItemChange(xp));
			mc.playerController.updateController();
			mc.playerController.processRightClick((EntityPlayer)mc.player, (World)mc.world, EnumHand.MAIN_HAND);
			if(aim.getValue()) {
				mc.player.connection.sendPacket((Packet<?>)new CPacketPlayer.Rotation(mc.player.rotationYaw, angle, mc.player.onGround));
			}
	    		mc.player.connection.sendPacket(new CPacketHeldItemChange(oldSlot));
			mc.playerController.updateController();
		}
		
	}

}
